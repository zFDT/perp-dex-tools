# é£ä¹¦é€šçŸ¥å‡çº§è¯´æ˜

## ğŸ‰ é‡å¤§æ›´æ–°ï¼šé£ä¹¦é€šçŸ¥å·²å‡çº§ä¸º Webhook æ–¹å¼

### ğŸ“… æ›´æ–°æ—¥æœŸï¼š2026-02-11

---

## âœ¨ æ–°ç‰¹æ€§

### ä»æµç¨‹ Webhook å‡çº§åˆ°ç¾¤è‡ªå®šä¹‰æœºå™¨äºº Webhook

**ä¹‹å‰çš„æ–¹å¼ï¼ˆå·²æ·˜æ±°ï¼‰ï¼š**
- âŒ éœ€è¦åœ¨é£ä¹¦åå°é…ç½®å¤æ‚çš„æµç¨‹
- âŒ éœ€è¦æ‰‹åŠ¨åˆ›å»ºå­—æ®µè§£æè§„åˆ™  
- âŒ æ ·å¼å›ºå®šï¼Œæ— æ³•è‡ªå®šä¹‰
- âŒ ç»´æŠ¤éº»çƒ¦ï¼Œä»£ç å’Œåå°è¦åŒæ­¥ä¿®æ”¹

**æ–°çš„æ–¹å¼ï¼ˆæ¨èï¼‰ï¼š**
- âœ… ç›´æ¥åœ¨ç¾¤é‡Œæ·»åŠ æœºå™¨äººå³å¯
- âœ… æ”¯æŒå¯Œæ–‡æœ¬äº¤äº’å¼å¡ç‰‡
- âœ… ä»£ç ä¸­å®Œå…¨æ§åˆ¶æ ·å¼ï¼ˆé¢œè‰²ã€å›¾æ ‡ã€å¸ƒå±€ï¼‰
- âœ… ç»´æŠ¤ç®€å•ï¼Œåªéœ€ä¿®æ”¹ä»£ç 

---

## ğŸ”„ è¿ç§»æŒ‡å—

### 1. è·å–æ–°çš„ Webhook URL

1. æ‰“å¼€é£ä¹¦ç¾¤ â†’ å³ä¸Šè§’"..." â†’ "è®¾ç½®"
2. é€‰æ‹©"ç¾¤æœºå™¨äºº" â†’ "æ·»åŠ æœºå™¨äºº" â†’ "è‡ªå®šä¹‰æœºå™¨äºº"
3. é…ç½®æœºå™¨äººåç§°ï¼ˆå¦‚"äº¤æ˜“æœºå™¨äºº"ï¼‰
4. ï¼ˆå¯é€‰ï¼‰è®¾ç½®å…³é”®è¯éªŒè¯
5. å¤åˆ¶ Webhook URL

æ ¼å¼ç¤ºä¾‹ï¼š
```
https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
```

### 2. æ›´æ–°ç¯å¢ƒå˜é‡

åœ¨ `.env` æ–‡ä»¶ä¸­ï¼š

```bash
# ğŸ†• æ–°æ–¹å¼ï¼šç¾¤è‡ªå®šä¹‰æœºå™¨äººï¼ˆæ¨èï¼‰
LARK_WEBHOOK_URL=https://open.feishu.cn/open-apis/bot/v2/hook/ä½ çš„webhookåœ°å€
LARK_WEBHOOK_KEYWORD=äº¤æ˜“  # å¯é€‰ï¼Œå¦‚æœè®¾ç½®äº†å…³é”®è¯éªŒè¯

# âš ï¸ æ—§æ–¹å¼ï¼šæµç¨‹ Webhookï¼ˆå·²æ·˜æ±°ï¼Œå¯ä»¥åˆ é™¤ï¼‰
# LARK_TOKEN=xxx
```

### 3. æµ‹è¯•æ–°é…ç½®

è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š

```bash
python test_lark_webhook.py
```

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ ä¼šåœ¨é£ä¹¦ç¾¤ä¸­æ”¶åˆ°5æ¡æµ‹è¯•é€šçŸ¥ï¼š
1. çº¯æ–‡æœ¬æ¶ˆæ¯
2. äº¤æ˜“ä¿¡å·é€šçŸ¥ï¼ˆç»¿è‰²å¡ç‰‡ï¼‰
3. é”™è¯¯å‘Šè­¦ï¼ˆçº¢è‰²å¡ç‰‡ï¼Œ@æ‰€æœ‰äººï¼‰
4. ç³»ç»Ÿå¯åŠ¨é€šçŸ¥ï¼ˆç»¿è‰²å¡ç‰‡ï¼‰
5. æ¯å°æ—¶ç»Ÿè®¡ï¼ˆè“è‰²å¡ç‰‡ï¼‰

---

## ğŸ“Š é€šçŸ¥æ•ˆæœå¯¹æ¯”

### å¯åŠ¨é€šçŸ¥

**æ—§ç‰ˆæœ¬ï¼š**
```
{
  "notification_type": "startup",
  "instance_id": "SOL_hao",
  "exchange": "backpack",
  "ticker": "SOL",
  "message": "Trading bot started...",
  "quantity": "0.5",
  "take_profit": "0.02"
}
```
â†’ çº¯æ–‡æœ¬ï¼Œéœ€è¦åå°è§£æï¼Œæ ·å¼å›ºå®š

**æ–°ç‰ˆæœ¬ï¼š**
- ğŸš€ ç»¿è‰²å¡ç‰‡æ ‡é¢˜
- ç»Ÿä¸€çš„åŸºç¡€ä¿¡æ¯æ¨¡å—ï¼ˆå®ä¾‹IDã€äº¤æ˜“æ‰€ã€äº¤æ˜“å¯¹ã€ç­–ç•¥å‚æ•°ï¼‰
- è¯¦ç»†çš„é…ç½®å‚æ•°è¡¨æ ¼
- æ—¶é—´æˆ³å’Œç³»ç»Ÿæ ‡è¯†

### é”™è¯¯é€šçŸ¥

**æ—§ç‰ˆæœ¬ï¼š**
```
{
  "notification_type": "error",
  "error_message": "Position mismatch",
  ...
}
```
â†’ éœ€è¦åå°é…ç½®ï¼Œä¸æ”¯æŒ@æ‰€æœ‰äºº

**æ–°ç‰ˆæœ¬ï¼š**
- âš ï¸ çº¢è‰²å¡ç‰‡æ ‡é¢˜
- è‡ªåŠ¨ @æ‰€æœ‰äºº
- é”™è¯¯ç±»å‹ã€æ¶ˆæ¯å’Œå †æ ˆé¢„è§ˆ
- ç»Ÿä¸€çš„åŸºç¡€ä¿¡æ¯æ¨¡å—

### æ¯å°æ—¶ç»Ÿè®¡

**æ—§ç‰ˆæœ¬ï¼š**
```
{
  "notification_type": "hourly_stats",
  "position_operations": 15,
  ...
}
```
â†’ å­—æ®µéœ€è¦åå°æ˜ å°„

**æ–°ç‰ˆæœ¬ï¼š**
- ğŸ“Š è“è‰²å¡ç‰‡æ ‡é¢˜
- ä¸­æ–‡å­—æ®µåï¼Œæ›´æ˜“è¯»
- åŒæ å¸ƒå±€ï¼Œä¿¡æ¯å¯†åº¦æ›´é«˜
- è‡ªåŠ¨è¿‡æ»¤ä¸å¿…è¦çš„å­—æ®µ

---

## ğŸ†• æ–°å¢åŠŸèƒ½

### 1. äº¤äº’å¼å¡ç‰‡

æ‰€æœ‰é€šçŸ¥éƒ½ä½¿ç”¨é£ä¹¦äº¤äº’å¼å¡ç‰‡ï¼Œæ”¯æŒï¼š
- **é¢œè‰²ä¸»é¢˜**ï¼šè“è‰²ï¼ˆä¿¡æ¯ï¼‰ã€ç»¿è‰²ï¼ˆæˆåŠŸï¼‰ã€çº¢è‰²ï¼ˆé”™è¯¯ï¼‰ã€æ©™è‰²ï¼ˆè­¦å‘Šï¼‰ã€ç°è‰²ï¼ˆä¸­æ€§ï¼‰
- **å›¾æ ‡**ï¼šğŸš€ ğŸ“ˆ ğŸ“‰ âš ï¸ ğŸ“Š ç­‰
- **æ¨¡å—åŒ–å¸ƒå±€**ï¼šæ ‡é¢˜ã€å­—æ®µã€åˆ†å‰²çº¿ã€å¤‡æ³¨ç­‰

### 2. ç»Ÿä¸€åŸºç¡€ä¿¡æ¯

æ‰€æœ‰é€šçŸ¥å¡ç‰‡éƒ½åŒ…å«ç»Ÿä¸€çš„åŸºç¡€ä¿¡æ¯æ¨¡å—ï¼š
- å®ä¾‹ID
- äº¤æ˜“æ‰€
- äº¤æ˜“å¯¹
- ç­–ç•¥å‚æ•°ï¼ˆåŒ…å«å®Œæ•´é…ç½®ï¼‰

### 3. æ™ºèƒ½é‡è¯•æœºåˆ¶

ç½‘ç»œä¸ç¨³å®šæ—¶è‡ªåŠ¨é‡è¯•ï¼ˆé»˜è®¤2æ¬¡ï¼‰ï¼Œæé«˜é€šçŸ¥æˆåŠŸç‡

### 4. å…³é”®è¯æ”¯æŒ

æ”¯æŒé£ä¹¦æœºå™¨äººçš„å…³é”®è¯éªŒè¯åŠŸèƒ½ï¼Œæé«˜å®‰å…¨æ€§

---

## ğŸ“ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

```bash
# å¿…å¡«
LARK_WEBHOOK_URL=https://open.feishu.cn/open-apis/bot/v2/hook/xxx

# å¯é€‰ï¼ˆå¦‚æœé£ä¹¦æœºå™¨äººé…ç½®äº†å…³é”®è¯éªŒè¯ï¼‰
LARK_WEBHOOK_KEYWORD=ä½ çš„å…³é”®è¯
```

### ä½¿ç”¨ç¤ºä¾‹

ä»£ç ä¸­æ— éœ€ä¿®æ”¹ï¼Œè‡ªåŠ¨ä½¿ç”¨æ–°çš„é€šçŸ¥æ–¹å¼ï¼š

```python
# åœ¨ trading_bot.py ä¸­
from helpers.lark_webhook import get_lark_webhook_bot

# è·å–æœºå™¨äººå®ä¾‹ï¼ˆè‡ªåŠ¨ä»ç¯å¢ƒå˜é‡è¯»å–é…ç½®ï¼‰
bot = get_lark_webhook_bot()

# å‘é€é€šçŸ¥
if bot:
    await bot.send_trade_signal(
        signal='LONG',
        ticker='BTC',
        price=50000.0,
        ...
    )
```

---

## ğŸ”§ å…¼å®¹æ€§

### å‘åå…¼å®¹

- âœ… æ—§çš„ `LARK_TOKEN` é…ç½®ä»ç„¶æœ‰æ•ˆï¼ˆå¦‚æœéœ€è¦ï¼‰
- âœ… æ–°æ—§æ–¹å¼å¯ä»¥å…±å­˜ï¼ˆä¼˜å…ˆä½¿ç”¨æ–°æ–¹å¼ï¼‰
- âœ… æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 

### æ¨èåšæ³•

1. **æ–°é¡¹ç›®**ï¼šç›´æ¥ä½¿ç”¨ `LARK_WEBHOOK_URL`
2. **ç°æœ‰é¡¹ç›®**ï¼š
   - æ·»åŠ  `LARK_WEBHOOK_URL` é…ç½®
   - æµ‹è¯•æ— è¯¯ååˆ é™¤ `LARK_TOKEN`
   - æ¸…ç†é£ä¹¦åå°çš„æµç¨‹é…ç½®

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é£ä¹¦ Webhook é…ç½®æŒ‡å—](docs/LARK_WEBHOOK_GUIDE.md)
- [é£ä¹¦å®˜æ–¹æ–‡æ¡£ - è‡ªå®šä¹‰æœºå™¨äºº](https://open.feishu.cn/document/client-docs/bot-v3/add-custom-bot)
- [é£ä¹¦å®˜æ–¹æ–‡æ¡£ - æ¶ˆæ¯å¡ç‰‡](https://open.feishu.cn/document/common-capabilities/message-card/message-cards-content/using-card-template)

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æˆ‘è¿˜éœ€è¦ä¿ç•™ LARK_TOKEN å—ï¼Ÿ

A: ä¸éœ€è¦ã€‚æ–°ç‰ˆæœ¬ä½¿ç”¨ `LARK_WEBHOOK_URL`ï¼Œå¯ä»¥åˆ é™¤ `LARK_TOKEN`ã€‚

### Q2: æ—§çš„æµç¨‹é…ç½®æ€ä¹ˆåŠï¼Ÿ

A: å¯ä»¥åœ¨é£ä¹¦ç®¡ç†åå°åˆ é™¤ï¼Œä¸å†éœ€è¦ã€‚

### Q3: å¦‚ä½•çŸ¥é“é€šçŸ¥æ˜¯å¦å‘é€æˆåŠŸï¼Ÿ

A: æŸ¥çœ‹ç»ˆç«¯æ—¥å¿—ï¼Œä¼šæ˜¾ç¤º"âœ“ é£ä¹¦æ¶ˆæ¯å‘é€æˆåŠŸ"æˆ–é”™è¯¯ä¿¡æ¯ã€‚

### Q4: å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªé£ä¹¦ç¾¤å—ï¼Ÿ

A: å¯ä»¥ã€‚ä¸ºä¸åŒçš„æœºå™¨äººå®ä¾‹é…ç½®ä¸åŒçš„ `.env` æ–‡ä»¶ï¼Œä½¿ç”¨ä¸åŒçš„ Webhook URLã€‚

### Q5: å…³é”®è¯éªŒè¯æ˜¯å¿…é¡»çš„å—ï¼Ÿ

A: ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†å»ºè®®å¯ç”¨ä»¥æé«˜å®‰å…¨æ€§ã€‚

---

## ğŸ¯ ä¼˜åŠ¿æ€»ç»“

| ç‰¹æ€§ | æ—§æ–¹å¼ | æ–°æ–¹å¼ |
|------|--------|--------|
| é…ç½®éš¾åº¦ | ğŸ”´ å¤æ‚ | ğŸŸ¢ ç®€å• |
| åå°é…ç½® | ğŸ”´ éœ€è¦ | ğŸŸ¢ ä¸éœ€è¦ |
| æ ·å¼è‡ªå®šä¹‰ | ğŸ”´ ä¸æ”¯æŒ | ğŸŸ¢ æ”¯æŒ |
| ç»´æŠ¤æˆæœ¬ | ğŸ”´ é«˜ | ğŸŸ¢ ä½ |
| é€šçŸ¥ç¾è§‚åº¦ | ğŸŸ¡ ä¸€èˆ¬ | ğŸŸ¢ ä¼˜ç§€ |
| åŠŸèƒ½æ‰©å±•æ€§ | ğŸ”´ å›°éš¾ | ğŸŸ¢ å®¹æ˜“ |

---

## ğŸš€ ç«‹å³å‡çº§

```bash
# 1. åœ¨é£ä¹¦ç¾¤ä¸­æ·»åŠ è‡ªå®šä¹‰æœºå™¨äººï¼Œè·å– Webhook URL

# 2. åœ¨ .env æ–‡ä»¶ä¸­é…ç½®
echo "LARK_WEBHOOK_URL=ä½ çš„webhookåœ°å€" >> .env

# 3. æµ‹è¯•é…ç½®
python test_lark_webhook.py

# 4. å¯åŠ¨äº¤æ˜“æœºå™¨äºº
python runbot.py --exchange backpack --ticker SOL --quantity 0.1
```

äº«å—å…¨æ–°çš„é€šçŸ¥ä½“éªŒå§ï¼ğŸ‰
